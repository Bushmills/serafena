# power strip socket state has changed.
# power strip owner signal this to the @event group
# the response by this service is to generate a desktop item, which reflects new power state, and toggles it by clicking on it. 

# $1: serial (MAC) of power strip
# $2: socket number (1..4)
# $3: symbolic name of device, plugged into socket. If none given, $3 will be $serial.$socket
# $4: the new socket power state: 0 or 1

# -------------- customise -------------
user="l"
icons="/usr/local/share/icons"
icon[1]="$icons/an.png"
icon[0]="$icons/aus.png"
path="/home/$user/Desktop"
mkdir -p $path
# --------------------------------------

serial="$1"
socket="$2"
name="$3"
state="$4"
file="$path/$serial.$socket.desktop"

# create another desktop item for new power service
cat > $file << EOF
#!/usr/bin/env xdg-open
[Desktop Entry]
Version=1.0
Type=Application
Terminal=false  
Exec=signal :power power toggle addr $serial $socket
Name=$name
Icon=${icon[state]}
EOF
chown $user $file
chmod +x $file
