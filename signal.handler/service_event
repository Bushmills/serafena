# receiver for events, like socket, mail, sent by issuer to @event group.
# events:
#   socket
#      power strip socket state has changed.
#      power strip owner signal this to the @event group
#      the response by this service is to generate a desktop item, which reflects new power state, and toggles it by clicking on it. 
#   mail
#      server updates biff on event receiver

# $1: event type  (socket, mail...)
# passed for socket event:
# $2: serial (MAC) of power strip
# $3: socket number (1..4)
# $4: symbolic name of device, plugged into socket. If none given, $3 will be $serial.$socket
# $5: the new socket power state: 0 or 1


event_socket()  {
   serial="$1"
   socket="$2"
   name="$3"
   state="$4"
   file="$path/$serial.$socket.desktop"

# consider to move this to fragments
# create another desktop item for new power service
cat > $file << EOF
#!/usr/bin/env xdg-open
[Desktop Entry]
Version=1.0
Type=Application
Terminal=false  
Exec=signal :power power toggle addr $serial $socket
Name=$name
Icon=${icon[state]}
EOF
chown $user $file
chmod +x $file
}


event_mail()  {
   touch $path/incoming_mail
}


event=$1
shift
type -t event_$event > /dev/null &&
event_$event $@
